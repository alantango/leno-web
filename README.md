### leno-web

A lab project to practice deploying standard java web app (.war) into a Tomcat docker image, then onto AWS ECS Fargate.

* Project is generated by `mvn archetype:generate`, choosing #1716 (org.apache.maven.archetypes:maven-archetype-webapp (An archetype which contains a sample Maven Webapp project.).

* Angular CLI version 8

* Angular project's tsconfig.json had `target` set to "es5". The default "es2015" triggers differential module generation and it didn't seem to work in Firefox.

* Package.json build script needs to have `base-href` set to "." instead of default "/", otherwise page doesn't load. Output is set to be directly into the Java app's webapp folder:

`"build": "ng build --output-path ../src/main/webapp --delete-output-path false --base-href=."`

* Tomcat image: tomcat:8.0

* After Java build (`mvn clean package`), run below to build the image that includes the .war:

`docker image build -t atang/leno-web-image:1.0 ./`

* Created public repo instead of standard private repo on ECR (to save $$)

* Then tag image:

`docker tag atang/leno-web-image:1.0 public.ecr.aws/a3z9u8f6/dummytest/leno-web:1.0`

* To log into the public ECR repo:

`aws ecr-public get-login-password --region us-east-2 | docker login --username AWS --password-stdin public.ecr.aws/a3z9u8f6`

> Note: Need to use AWS CLI v2, v1 doesn't have `ecr-public` operation.

* And then push the image:

`docker push public.ecr.aws/a3z9u8f6/dummytest/leno-web:1.0`
